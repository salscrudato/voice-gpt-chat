import{n as O,p as k}from"./firebase-BDQ_IqO2.js";import{a as g}from"./components-Cm3evySW.js";const E="voicegpt_user_name";function W(){return localStorage.getItem(E)}function K(t){const e=t.trim();return e.length<2||e.length>50?!1:(localStorage.setItem(E,e),!0)}var s;(function(t){t.INFO="info",t.WARNING="warning",t.ERROR="error",t.CRITICAL="critical"})(s||(s={}));class _{constructor(){Object.defineProperty(this,"logs",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"maxLogs",{enumerable:!0,configurable:!0,writable:!0,value:1e3})}log(e,r=s.INFO,n,i){const c={timestamp:new Date().toISOString(),severity:r,message:e,error:n,context:i,stack:n?.stack};this.logs.push(c),this.logs.length>this.maxLogs&&this.logs.shift();const u=r===s.CRITICAL?"error":r;u in console&&console[u](`[${r.toUpperCase()}] ${e}`,{error:n,context:i})}classifyError(e){const r=e?.message||String(e),n=e?.code||"UNKNOWN_ERROR";return r.includes("Network")||r.includes("fetch")?{code:"NETWORK_ERROR",message:"Network connection failed. Please check your internet connection.",severity:s.ERROR,recoverable:!0,retryAction:"retry"}:r.includes("timeout")||r.includes("Timeout")?{code:"TIMEOUT_ERROR",message:"Request timed out. Please try again.",severity:s.WARNING,recoverable:!0,retryAction:"retry"}:r.includes("401")||r.includes("Unauthorized")?{code:"AUTH_ERROR",message:"Authentication failed. Please refresh and try again.",severity:s.ERROR,recoverable:!0,retryAction:"refresh"}:r.includes("429")||r.includes("Rate limit")?{code:"RATE_LIMIT_ERROR",message:"Too many requests. Please wait a moment and try again.",severity:s.WARNING,recoverable:!0,retryAction:"wait"}:r.includes("400")||r.includes("Invalid")?{code:"VALIDATION_ERROR",message:"Invalid request. Please check your input.",severity:s.WARNING,recoverable:!1}:r.includes("500")||r.includes("Internal")?{code:"SERVER_ERROR",message:"Server error. Please try again later.",severity:s.ERROR,recoverable:!0,retryAction:"retry"}:r.includes("503")||r.includes("unavailable")?{code:"SERVICE_UNAVAILABLE",message:"Service temporarily unavailable. Please try again later.",severity:s.ERROR,recoverable:!0,retryAction:"queue"}:{code:n,message:"An unexpected error occurred. Please try again.",severity:s.WARNING,recoverable:!0,retryAction:"retry"}}getUserMessage(e){return this.classifyError(e).message||"An unexpected error occurred"}shouldRetry(e){const r=this.classifyError(e);return(r.recoverable??!1)&&r.retryAction==="retry"}getRetryDelay(e,r){const n=this.classifyError(e);return n.code==="RATE_LIMIT_ERROR"?Math.min(1e3*Math.pow(2,r),3e4):n.code==="TIMEOUT_ERROR"?Math.min(500*Math.pow(1.5,r),1e4):Math.min(1e3*Math.pow(2,r),3e4)}getLogs(){return[...this.logs]}clearLogs(){this.logs=[]}exportLogs(){return JSON.stringify(this.logs,null,2)}}const A=new _,j=(t,e)=>A.log(t,s.INFO,void 0,e),Z=(t,e,r)=>A.log(t,s.ERROR,e,r);function G(t){const n=["audio/webm","audio/mp3","audio/wav","audio/m4a","audio/mp4"];if(t.size<1024)return{valid:!1,error:"Recording is too short. Please record at least a few seconds."};if(t.size>52428800)return{valid:!1,error:`File size exceeds ${52428800/1024/1024}MB limit`};if(t.type){const i=t.type.split(";")[0];if(!n.includes(i))return{valid:!1,error:`File type ${t.type} not supported. Supported types: ${n.join(", ")}`}}return{valid:!0}}function V(t){const e=t.trim();return e.length<2?{valid:!1,error:"Name must be at least 2 characters"}:e.length>50?{valid:!1,error:"Name must be less than 50 characters"}:/^[a-zA-Z0-9\s\-']+$/.test(e)?{valid:!0}:{valid:!1,error:"Name contains invalid characters"}}function Y(t){const e=t.trim();return e.length===0?{valid:!1,error:"Message cannot be empty"}:e.length>5e3?{valid:!1,error:"Message exceeds 5000 character limit"}:{valid:!0}}async function J(){return new Promise((t,e)=>{const r=O(g,async n=>{if(r(),n)t(n);else try{const i=await k(g);t(i.user)}catch(i){e(i)}})})}async function X(t=!1){const e=g.currentUser;if(!e)throw new Error("No authenticated user");try{return await e.getIdToken(t)}catch(r){throw console.error("Failed to get ID token:",r),r}}function Q(){return g.currentUser?.uid||null}function B(t,e){if(t.length===0)return L();let r=0,n=0,i=0;const c=.99;for(let o=0;o<t.length;o++){const d=t[o];r+=d*d,n=Math.max(n,Math.abs(d)),Math.abs(d)>c&&i++}const l=Math.sqrt(r/t.length),u=i/t.length*100,R=Array.from(t).map(Math.abs).sort((o,d)=>o-d),m=R[Math.floor(R.length*.1)],p=l>0&&m>0?20*Math.log10(l/m):0,N=m*1.5;let w=0;for(let o=0;o<t.length;o++)Math.abs(t[o])<N&&w++;const I=w/t.length*100;let h;u>1?h="clipping":l<.05?h="low":l>.7?h="high":h="optimal";let a=100;a-=Math.min(u*2,30),p<10?a-=20:p<20&&(a-=10),I>50&&(a-=15),l<.05&&(a-=20),a=Math.max(0,Math.min(100,a));let y=128;return a>80?y=192:a<50&&(y=96),{rms:l,peakLevel:n,noiseFloor:m,signalToNoise:p,clipping:u,silenceRatio:I,qualityScore:Math.round(a),recommendedBitrate:y,audioLevel:h}}function L(){return{rms:0,peakLevel:0,noiseFloor:0,signalToNoise:0,clipping:0,silenceRatio:100,qualityScore:0,recommendedBitrate:128,audioLevel:"low"}}const C=6e4,f=new Map,S=new Map;async function ee(t,e={}){const r=e.idempotencyKey||`${Date.now()}-${Math.random()}`;if(f.has(r))return f.get(r);const n=S.get(r);if(n&&Date.now()-n.timestamp<C)return n.result;const i=t();f.set(r,i);try{const c=await i;return S.set(r,{result:c,timestamp:Date.now()}),c}finally{f.delete(r)}}function x(t){const e=JSON.stringify(t);let r=0;for(let n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n);return`${Date.now()}-${Math.abs(r)}`}const te=x;class U{constructor(){Object.defineProperty(this,"listeners",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"currentState",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"healthCheckInterval",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"HEALTH_CHECK_INTERVAL_MS",{enumerable:!0,configurable:!0,writable:!0,value:3e4}),this.currentState=this.getInitialState(),this.setupListeners()}getInitialState(){const e=navigator.connection||navigator.mozConnection;return{isOnline:navigator.onLine,effectiveType:e?.effectiveType||"unknown",downlink:e?.downlink||0,rtt:e?.rtt||0,saveData:e?.saveData||!1,lastChecked:Date.now()}}setupListeners(){window.addEventListener("online",()=>this.updateState()),window.addEventListener("offline",()=>this.updateState());const e=navigator.connection||navigator.mozConnection;e&&e.addEventListener("change",()=>this.updateState()),this.startHealthChecks()}startHealthChecks(){this.healthCheckInterval=setInterval(()=>{this.performHealthCheck()},this.HEALTH_CHECK_INTERVAL_MS)}async performHealthCheck(){try{const e=new AbortController,r=setTimeout(()=>e.abort(),5e3),n=await fetch("/health",{method:"HEAD",signal:e.signal});clearTimeout(r),!n.ok&&navigator.onLine&&console.warn("[NetworkManager] Health check failed but online status is true")}catch(e){navigator.onLine&&console.warn("[NetworkManager] Health check failed:",e)}}updateState(){const e=this.getInitialState();JSON.stringify(e)!==JSON.stringify(this.currentState)&&(this.currentState=e,console.log("[NetworkManager] Network state changed:",e),this.notifyListeners())}notifyListeners(){this.listeners.forEach(e=>{try{e(this.currentState)}catch(r){console.error("[NetworkManager] Listener error:",r)}})}getState(){return{...this.currentState}}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}isGoodForUploads(){return this.currentState.isOnline&&(this.currentState.effectiveType==="4g"||this.currentState.effectiveType==="3g")}isGoodForStreaming(){return this.currentState.isOnline&&this.currentState.effectiveType!=="slow-2g"}estimateUploadTime(e){return!this.currentState.isOnline||this.currentState.downlink===0?1/0:e*8/1e6/this.currentState.downlink*1e3}destroy(){this.healthCheckInterval&&clearInterval(this.healthCheckInterval),this.listeners.clear()}}let v=null;function re(){return v||(v=new U),v}const M=[{mimeType:"audio/webm;codecs=opus",extension:"webm",priority:1,supported:!1},{mimeType:"audio/webm",extension:"webm",priority:2,supported:!1},{mimeType:"audio/mp4",extension:"m4a",priority:3,supported:!1},{mimeType:"audio/wav",extension:"wav",priority:4,supported:!1},{mimeType:"audio/ogg",extension:"ogg",priority:5,supported:!1}],b=500*1024*1024,P=1024,D=["audio/webm","audio/mp4","audio/m4a","audio/wav","audio/mp3","audio/ogg"];function T(){return M.map(t=>({...t,supported:MediaRecorder.isTypeSupported(t.mimeType)})).filter(t=>t.supported)}function H(){const t=T();return t.length>0?t[0]:null}function z(t){const e=t.split(";")[0];return M.find(r=>r.mimeType.startsWith(e))||null}function ne(t){return t?t.size===0?{valid:!1,error:"Audio file is empty"}:t.size<P?{valid:!1,error:"Audio file is too small (minimum 1KB)"}:t.size>b?{valid:!1,error:`Audio file is too large (max ${b/1024/1024}MB)`}:D.some(e=>t.type.startsWith(e))?{valid:!0}:{valid:!1,error:`Invalid audio format: ${t.type||"unknown"}`}:{valid:!1,error:"Audio blob is missing"}}function ie(t){const e=z(t);if(e)return e.extension;const r={"audio/webm":"webm","audio/mp4":"m4a","audio/m4a":"m4a","audio/wav":"wav","audio/mp3":"mp3","audio/ogg":"ogg"},n=t.split(";")[0];return r[n]||"webm"}function se(){const t=T(),e=H();console.log("[AudioCodec] Supported codecs:",{best:e?.mimeType,all:t.map(r=>r.mimeType)})}function F(t){const e=document.documentElement;e.style.colorScheme="light",e.classList.remove("dark-mode")}function ae(){F()}export{j as a,H as b,B as c,Z as d,G as e,re as f,Q as g,te as h,ie as i,ee as j,Y as k,se as l,X as m,V as n,ae as o,J as p,W as q,K as s,ne as v};
