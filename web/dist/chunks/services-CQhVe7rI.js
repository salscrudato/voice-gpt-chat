import{c as d,q as h,o as g,l as m,e as i,s as u,f as c,m as p}from"./firebase-BDQ_IqO2.js";import{d as n}from"./components-DeDZtZlW.js";function l(e){const t=e.transcript.split(/\s+/).filter(a=>a.length>0).length,s=Math.ceil(t/200);return{memoId:e.memoId,wordCount:t,readingTime:s}}async function A(e,t){try{const s=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a=i(n,"users",e,"chatSessions",s),o={id:s,userId:e,title:t,messages:[],createdAt:new Date,updatedAt:new Date,totalTokens:0};return await u(a,{...o,createdAt:c(),updatedAt:c()}),o}catch(s){throw console.error("Error creating chat session:",s),s}}async function D(e){try{const t=d(n,"users",e,"chatSessions"),s=h(t,g("updatedAt","desc"));return(await m(s)).docs.map(o=>({id:o.id,...o.data(),createdAt:o.data().createdAt?.toDate?.()||new Date,updatedAt:o.data().updatedAt?.toDate?.()||new Date}))}catch(t){throw console.error("Error fetching chat sessions:",t),t}}async function S(e,t,s){try{const a=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o=i(n,"users",e,"chatSessions",t,"messages",a);await u(o,{...s,createdAt:c()});const r=i(n,"users",e,"chatSessions",t);await p(r,{updatedAt:c()})}catch(a){throw console.error("Error adding message to session:",a),a}}async function y(e,t){try{const s=d(n,"users",e,"chatSessions",t,"messages"),a=h(s,g("createdAt","asc"));return(await m(a)).docs.map(r=>({id:r.id,...r.data(),timestamp:r.data().createdAt?.toDate?.()||new Date}))}catch(s){throw console.error("Error fetching session messages:",s),s}}export{D as a,y as b,A as c,S as d,l as g};
